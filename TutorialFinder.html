<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Tutorial Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom gradient background using YouTube-inspired colors */
        body {
            background: linear-gradient(to bottom right, #FF4E50, #FC913A, #F9D423); /* Shades of red, orange, yellow */
            min-height: 100vh; /* Ensure gradient covers the full viewport height */
            font-family: 'Inter', sans-serif; /* Use Inter font */
            color: #ffffff; /* Default text color white for contrast */
            line-height: 1.6;
        }

        /* Style for the search input focus state */
        input[type="text"]:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.5); /* YouTube red glow */
            border-color: #FF0000; /* YouTube red border */
        }

        /* Style for the video result items */
        .video-item {
            background-color: rgba(255, 255, 255, 0.15); /* Slightly more opaque background */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* shadow-md */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 1.5rem; /* mb-6 */
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack elements vertically by default */
            gap: 1rem; /* Space between elements */
            align-items: center; /* Center items horizontally by default */
            text-align: center; /* Center text by default */
            cursor: pointer; /* Indicate that the item is clickable */
            transition: transform 0.2s ease-in-out; /* Add a slight hover effect */
        }

        .video-item:hover {
            transform: translateY(-5px); /* Lift the item slightly on hover */
        }

        .video-item .video-thumbnail-container {
            position: relative; /* Needed for aspect ratio padding */
            width: 100%; /* Take full width of the container */
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio (height / width * 100) */
            height: 0; /* Hide the container's height */
            overflow: hidden; /* Hide anything outside the padding */
            border-radius: 0.25rem; /* rounded */
            pointer-events: none; /* Prevent clicks on the container itself, rely on parent .video-item */
        }

        .video-item img {
             display: block; /* Ensure image doesn't have extra space below */
             width: 100%; /* Make image fill container */
             height: 100%; /* Make image fill container */
             object-fit: cover; /* Cover the container while maintaining aspect ratio */
        }

        .video-item svg {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
        }

        .video-item .video-details {
            width: 100%; /* Take full width */
        }

        .video-item h3 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            margin-bottom: 0.5rem; /* mb-2 */
            color: #ffffff; /* Text color white */
        }

        .video-item p {
            font-size: 1rem; /* text-base */
            color: #d1d5db; /* gray-300 */
        }

         /* Style for recommendation sections */
        .recommendation-section {
            background-color: rgba(255, 255, 255, 0.1); /* Slightly transparent white */
            padding: 1.5rem; /* p-6 */
            border-radius: 0.75rem; /* rounded-xl */
            margin-top: 2rem; /* mt-8 */
            text-align: left; /* Align text left */
        }

        .recommendation-section h2 {
            font-size: 2rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            margin-bottom: 1.5rem; /* mb-6 */
            text-align: center; /* Center the heading */
            color: #ffffff; /* White text */
        }

        .recommendation-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Responsive grid */
            gap: 1.5rem; /* Gap between items */
        }

        .recommendation-item {
             background-color: rgba(255, 255, 255, 0.15); /* Slightly more opaque background */
             padding: 1rem; /* p-4 */
             border-radius: 0.5rem; /* rounded-lg */
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* shadow-sm */
        }

        .recommendation-item h4 {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            margin-bottom: 0.5rem; /* mb-2 */
             color: #ffffff; /* White text */
        }

        .recommendation-item a {
            color: #a78bfa; /* Purple link color (Tailwind's violet-400) */
            text-decoration: none; /* No underline */
            transition: color 0.3s ease; /* Smooth color transition */
        }

        .recommendation-item a:hover {
            color: #c4b5fd; /* Lighter purple on hover (Tailwind's violet-300) */
            text-decoration: underline; /* Underline on hover */
        }

         /* Style for loading and error messages */
        #results-container p {
            text-align: center;
            font-size: 1.2rem;
            color: #ffffff;
        }

        /* Status badges for videos */
        .video-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .badge-verified {
            background-color: #10B981; /* Green */
            color: #FFFFFF;
        }

        .badge-educational {
            background-color: #3B82F6; /* Blue */
            color: #FFFFFF;
        }

        .badge-canva {
            background-color: #00C4CC; /* Canva blue */
            color: #FFFFFF;
        }

        .badge-quizizz {
            background-color: #FF7262; /* Quizizz coral */
            color: #FFFFFF;
        }

        .badge-hd {
            background-color: #6366F1; /* Indigo */
            color: #FFFFFF;
        }

        /* Fullscreen Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.9); /* Black background with opacity */
            justify-content: center; /* Center content horizontally */
            align-items: center; /* Center content vertically */
            padding: 20px; /* Add some padding around the modal content */
            opacity: 0; /* Start with 0 opacity for fade-in effect */
            transition: opacity 0.3s ease; /* Smooth opacity transition */
        }

        .modal.show {
            opacity: 1; /* Full opacity when visible */
        }

        .modal-content {
            position: relative; /* Needed for close button positioning */
            margin: auto; /* Auto margin for centering */
            width: 95%; /* 95% width */
            max-width: 1200px; /* Max width */
            height: 95%; /* 95% height */
            max-height: 800px; /* Max height */
            display: flex; /* Use flexbox for iframe centering */
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1); /* Slight background for modal content */
            border-radius: 0.5rem; /* Rounded corners */
        }

        .modal-content iframe {
            width: 100%; /* Make iframe fill its container */
            height: 100%; /* Make iframe fill its container */
            border: none; /* Remove iframe border */
            opacity: 0; /* Start with 0 opacity */
            transition: opacity 0.5s ease; /* Smooth opacity transition */
            z-index: 2; /* Place above thumbnail */
        }

        .modal-content iframe.loaded {
            opacity: 1; /* Full opacity when loaded */
        }

        /* SVG Fallback thumbnail for modal */
        .modal-svg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0.8;
            transition: opacity 0.5s ease;
            border-radius: 0.5rem;
        }

        .modal-svg-container.fade-out {
            opacity: 0;
        }

        .modal-svg-container svg {
            width: 100%;
            height: 100%;
            border-radius: 0.5rem;
        }

        /* Thumbnail background for modal */
        .modal-thumbnail {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 1;
            opacity: 0.7;
            transition: opacity 0.5s ease;
            border-radius: 0.5rem; /* Match modal content corners */
        }

        .modal-thumbnail.fade-out {
            opacity: 0;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 25px;
            color: #fff;
            font-size: 35px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            z-index: 1001; /* Ensure close button is above iframe */
        }

        .close-button:hover,
        .close-button:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* Loading Spinner */
        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3; /* Above both thumbnail and iframe */
        }

        .loader {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #FF0000; /* YouTube red */
            width: 50px;
            height: 50px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        .play-button-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background-color: rgba(255, 0, 0, 0.8); /* YouTube red */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .play-button-overlay:hover {
            background-color: rgba(255, 0, 0, 1);
            width: 90px;
            height: 90px;
        }

        .play-button-overlay svg {
            width: 40px;
            height: 40px;
            fill: white;
        }

        /* Apply different sizes for thumbnail containers in recommendations */
        .recommendation-item .video-thumbnail-container {
            margin-bottom: 10px;
        }

        /* Custom SVG thumbnail styles */
        .svg-thumbnail {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .svg-thumbnail text {
            fill: white;
            font-family: 'Inter', sans-serif;
            font-weight: bold;
            text-anchor: middle;
        }

        .svg-thumbnail .title-text {
            font-size: 24px;
        }

        .svg-thumbnail .subtitle-text {
            font-size: 16px;
            fill-opacity: 0.8;
        }

        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No results message */
        .no-results {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
        }

        .no-results h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #ffffff;
        }

        .no-results p {
            font-size: 1rem;
            color: #d1d5db;
            margin-bottom: 1.5rem;
        }

        .no-results button {
            background-color: #5D5CDE;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .no-results button:hover {
            background-color: #4A49B9;
        }

        @media (min-width: 768px) { /* Apply flex layout on medium screens and up */
            .video-item {
                 flex-direction: row; /* Row layout on larger screens */
                 align-items: flex-start; /* Align items to the top */
                 text-align: left; /* Align text left */
            }

            .video-item .video-thumbnail-container {
                 width: 180px; /* Fixed width for embedded video container */
                 flex-shrink: 0; /* Prevent shrinking */
                 padding-bottom: 0; /* Remove padding-bottom when height is fixed */
                 height: 100px; /* Fixed height for embedded video container */
            }

             .video-item img {
                 width: 180px; /* Fixed width for thumbnail */
                 height: 100px; /* Fixed height for thumbnail */
                 object-fit: cover; /* Ensure image covers the container */
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .modal {
                background-color: rgba(0, 0, 0, 0.95); /* Darker background in dark mode */
            }
        }
    </style>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="flex flex-col items-center justify-center p-4">

    <div class="container mx-auto text-center py-12 px-6 bg-white bg-opacity-10 rounded-xl shadow-lg max-w-4xl">
        <h1 class="text-4xl md:text-5xl font-bold mb-6 text-white drop-shadow-md">
            Find Your Next Tutorial
        </h1>
        <p class="text-lg md:text-xl mb-8 text-gray-100">
            Discover amazing tutorials on YouTube for anything you want to learn.
        </p>

        <div class="w-full max-w-md mx-auto mb-8">
            <div class="flex items-center border-2 border-gray-300 rounded-full overflow-hidden shadow-md">
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search for tutorials..."
                    class="w-full py-3 px-6 text-gray-800 leading-tight focus:outline-none rounded-l-full"
                >
                <button id="search-button" class="bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-r-full transition duration-300 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span class="ml-2 hidden md:inline">Search</span>
                </button>
            </div>
        </div>

        <div id="results-container" class="mt-8 text-left">
            </div>

         <div class="recommendation-section">
            <h2>Recommended Tutorials</h2>
            <div class="recommendation-list" id="recommendation-list">
                <!-- Recommendation items will be populated with thumbnails via JavaScript -->
            </div>
        </div>

    </div>

    <div id="fullscreen-modal" class="modal">
        <span class="close-button">×</span>
        <div class="modal-content">
            <img id="modal-thumbnail" class="modal-thumbnail" src="" alt="Video thumbnail">
            <div id="modal-svg-container" class="modal-svg-container">
                <!-- SVG thumbnail will be dynamically inserted here -->
            </div>
            <div class="loader-container" id="video-loader">
                <div class="loader"></div>
            </div>
            <iframe id="modal-video-iframe"
                src=""
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
    </div>

    <footer class="mt-12 text-center text-gray-200 text-sm">
        <p>© 2023 Tutorial Finder. All rights reserved.</p>
    </footer>

    <script>
        // IMPORTANT NOTE: Including the API key directly in client-side JavaScript
        // is generally NOT recommended for production applications as it can be easily
        // extracted and misused. For a real application, you should handle API calls
        // on a secure backend server.
        const API_KEY = 'AIzaSyBYCYT99I2Ah_taeKaHYxRBghil_mbBbGA'; // Your YouTube Data API Key
        const SEARCH_URL = 'https://www.googleapis.com/youtube/v3/search';
        const VIDEOS_URL = 'https://www.googleapis.com/youtube/v3/videos';
        // Base URL for embedding YouTube videos
        const EMBED_BASE_URL = 'https://www.youtube.com/embed/';
        // Base URL for video thumbnails (highest quality)
        const THUMBNAIL_BASE_URL = 'https://img.youtube.com/vi/';
        const THUMBNAIL_DEFAULT = '/maxresdefault.jpg'; // Highest quality
        const THUMBNAIL_FALLBACK = '/hqdefault.jpg'; // Fallback if maxres is not available

        // Store thumbnails and video data for videos
        const videoThumbnails = {};
        const videoData = {};
        const svgThumbnails = {};

        // Get references to DOM elements
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const resultsContainer = document.getElementById('results-container');
        const recommendationList = document.getElementById('recommendation-list');
        const fullscreenModal = document.getElementById('fullscreen-modal');
        const modalVideoIframe = document.getElementById('modal-video-iframe');
        const modalThumbnail = document.getElementById('modal-thumbnail');
        const modalSvgContainer = document.getElementById('modal-svg-container');
        const closeButton = document.querySelector('.close-button');
        const videoLoader = document.getElementById('video-loader');

        // Updated recommendations for Canva and Quizizz tutorials
        const recommendedTutorials = [
            {
                title: "Canva Code Tutorial",
                description: "Learn how to use Canva's code features to enhance your design workflow.",
                query: "Canva Code tutorial",
                videoId: "JGwWNGJdvx8", // This is a placeholder - we'll generate an SVG for it
                type: "canva",
                color1: "#00C4CC", // Canva blue
                color2: "#7D2AE8"  // Canva purple
            },
            {
                title: "Canva AI Tutorial",
                description: "Explore how to leverage Canva's AI features to automate and enhance your designs.",
                query: "Canva AI tutorial",
                videoId: "kfBkRT_0oZ0",
                type: "canva",
                color1: "#00C4CC", // Canva blue
                color2: "#8B3DFF"  // Purple variant
            },
            {
                title: "Canva Sheets Tutorial",
                description: "Learn how to use Canva Sheets to create data-driven designs and visualizations.",
                query: "Canva Sheets tutorial",
                videoId: "5eANbVL5Um0",
                type: "canva",
                color1: "#00C4CC", // Canva blue
                color2: "#0CC06C"  // Green variant
            },
            {
                title: "Quizizz for Educators",
                description: "Discover how to create engaging quizzes and assessments with Quizizz for your classroom.",
                query: "Quizizz Tutorial for Educators",
                videoId: "bz7egnNlJXs",
                type: "quizizz",
                color1: "#FF7262", // Quizizz coral
                color2: "#8854C0"  // Quizizz purple
            }
        ];

        // Function to generate SVG thumbnail for videos
        function generateSvgThumbnail(title, type, color1, color2) {
            // Create SVG namespace
            const xmlns = "http://www.w3.org/2000/svg";
            
            // Create gradient based on video type
            let gradientDef, iconPath;
            
            if (type === "canva") {
                gradientDef = `
                    <linearGradient id="grad-${title.replace(/\s+/g, '-')}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:${color1};stop-opacity:1" />
                        <stop offset="100%" style="stop-color:${color2};stop-opacity:1" />
                    </linearGradient>
                `;
                // Simplified Canva-like icon
                iconPath = `
                    <g transform="translate(250, 120) scale(0.8)">
                        <path d="M-30,0 A30,30 0 1,1 30,0 A30,30 0 1,1 -30,0 Z" fill="white" opacity="0.9"/>
                        <path d="M-20,-20 L20,-20 L20,20 L-20,20 Z" fill="white" opacity="0.7"/>
                        <path d="M-40,40 L40,40 L40,-10 L10,-10 L10,10 L-10,10 L-10,-40 L-40,-40 Z" fill="white" opacity="0.5"/>
                    </g>
                `;
            } else if (type === "quizizz") {
                gradientDef = `
                    <linearGradient id="grad-${title.replace(/\s+/g, '-')}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:${color1};stop-opacity:1" />
                        <stop offset="100%" style="stop-color:${color2};stop-opacity:1" />
                    </linearGradient>
                `;
                // Simplified Quizizz-like icon
                iconPath = `
                    <g transform="translate(250, 120) scale(0.8)">
                        <circle cx="0" cy="0" r="40" fill="white" opacity="0.8"/>
                        <rect x="-20" y="-20" width="15" height="15" rx="2" fill="white" opacity="0.9"/>
                        <rect x="5" y="-20" width="15" height="15" rx="2" fill="white" opacity="0.9"/>
                        <rect x="-20" y="5" width="15" height="15" rx="2" fill="white" opacity="0.9"/>
                        <rect x="5" y="5" width="15" height="15" rx="2" fill="white" opacity="0.9"/>
                    </g>
                `;
            } else {
                // Default generic gradient and icon
                gradientDef = `
                    <linearGradient id="grad-${title.replace(/\s+/g, '-')}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#5D5CDE;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FF4E50;stop-opacity:1" />
                    </linearGradient>
                `;
                // Generic play icon
                iconPath = `
                    <g transform="translate(250, 120) scale(0.8)">
                        <circle cx="0" cy="0" r="50" fill="white" opacity="0.8"/>
                        <path d="M-15,-25 L25,0 L-15,25 Z" fill="white" opacity="0.9"/>
                    </g>
                `;
            }
            
            // Create the SVG string
            const svgString = `
                <svg xmlns="${xmlns}" viewBox="0 0 500 281" preserveAspectRatio="xMidYMid slice" class="svg-thumbnail">
                    <defs>
                        ${gradientDef}
                        <!-- Diagonal line pattern -->
                        <pattern id="diagonalLines" patternUnits="userSpaceOnUse" width="10" height="10" patternTransform="rotate(45)">
                            <line x1="0" y1="0" x2="0" y2="10" style="stroke:white; stroke-width:1; stroke-opacity:0.2" />
                        </pattern>
                    </defs>
                    
                    <!-- Background with gradient -->
                    <rect width="100%" height="100%" fill="url(#grad-${title.replace(/\s+/g, '-')})" />
                    
                    <!-- Decorative elements -->
                    <circle cx="400" cy="50" r="80" fill="white" opacity="0.1" />
                    <circle cx="80" cy="220" r="60" fill="white" opacity="0.1" />
                    <rect x="0" y="0" width="100%" height="100%" fill="url(#diagonalLines)" />
                    
                    <!-- Type-specific icon -->
                    ${iconPath}
                    
                    <!-- Title -->
                    <text x="50%" y="70%" class="title-text" dominant-baseline="middle">${title}</text>
                    <text x="50%" y="80%" class="subtitle-text" dominant-baseline="middle">Tutorial</text>
                    
                    <!-- Play button icon -->
                    <g transform="translate(250, 140)">
                        <circle cx="0" cy="0" r="30" fill="rgba(255, 0, 0, 0.8)" />
                        <path d="M-10,-15 L15,0 L-10,15 Z" fill="white" />
                    </g>
                </svg>
            `;
            
            return svgString;
        }

        // Function to check if a video is playable and has no restrictions
        async function checkVideoPlayability(videoId) {
            try {
                // Skip API check for known good videos in our recommendations
                if (recommendedTutorials.some(v => v.videoId === videoId)) {
                    return true;
                }
                
                // Get video details including content details and status
                const response = await fetch(
                    `${VIDEOS_URL}?part=status,contentDetails&id=${videoId}&key=${API_KEY}`
                );
                
                if (!response.ok) {
                    console.error('Failed to fetch video details');
                    return false;
                }
                
                const data = await response.json();
                
                // If no items found, video doesn't exist or is not accessible
                if (!data.items || data.items.length === 0) {
                    return false;
                }
                
                const videoInfo = data.items[0];
                
                // Store video data for later use
                videoData[videoId] = videoInfo;
                
                // Check if video is embeddable
                if (videoInfo.status && videoInfo.status.embeddable === false) {
                    console.log(`Video ${videoId} is not embeddable`);
                    return false;
                }
                
                // Check privacy status - must be 'public'
                if (videoInfo.status && videoInfo.status.privacyStatus !== 'public') {
                    console.log(`Video ${videoId} is not public: ${videoInfo.status.privacyStatus}`);
                    return false;
                }
                
                // Check for region restrictions
                if (videoInfo.contentDetails && videoInfo.contentDetails.regionRestriction) {
                    console.log(`Video ${videoId} has region restrictions`);
                    return false;
                }
                
                // Check for age restrictions by looking at content rating
                if (videoInfo.contentDetails && videoInfo.contentDetails.contentRating) {
                    const rating = videoInfo.contentDetails.contentRating;
                    // Check for common age restriction indicators
                    if (rating.ytRating === 'ytAgeRestricted') {
                        console.log(`Video ${videoId} is age restricted`);
                        return false;
                    }
                }
                
                // All checks passed
                return true;
                
            } catch (error) {
                console.error('Error checking video playability:', error);
                return false;
            }
        }

        // Function to populate recommendation items with thumbnails
        async function populateRecommendations() {
            recommendationList.innerHTML = '';
            
            // For each recommended tutorial
            for (const item of recommendedTutorials) {
                const videoId = item.videoId;
                
                // Generate and store SVG thumbnail
                const svgThumbnail = generateSvgThumbnail(
                    item.title, 
                    item.type, 
                    item.color1, 
                    item.color2
                );
                svgThumbnails[videoId] = svgThumbnail;
                
                // Try to get real thumbnail
                let thumbnailUrl = null;
                let useSvg = true;
                
                try {
                    // Check if thumbnail exists at highest quality
                    thumbnailUrl = `${THUMBNAIL_BASE_URL}${videoId}${THUMBNAIL_DEFAULT}`;
                    const thumbnailExists = await checkImage(thumbnailUrl);
                    
                    if (thumbnailExists) {
                        // Use actual thumbnail
                        videoThumbnails[videoId] = thumbnailUrl;
                        useSvg = false;
                    } else {
                        // Try fallback thumbnail
                        thumbnailUrl = `${THUMBNAIL_BASE_URL}${videoId}${THUMBNAIL_FALLBACK}`;
                        const fallbackExists = await checkImage(thumbnailUrl);
                        
                        if (fallbackExists) {
                            videoThumbnails[videoId] = thumbnailUrl;
                            useSvg = false;
                        }
                    }
                } catch (e) {
                    // Use SVG if there's an error
                    useSvg = true;
                }
                
                // Badge class based on tutorial type
                const badgeClass = item.type === 'canva' ? 'badge-canva' : 'badge-quizizz';
                
                // Create recommendation item HTML
                const thumbnailHtml = useSvg ? 
                    svgThumbnail : 
                    `<img src="${thumbnailUrl}" alt="${item.title}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">`;
                
                const recommendationHtml = `
                    <div class="recommendation-item">
                        <div class="video-thumbnail-container" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 0.25rem; margin-bottom: 0.75rem;">
                            ${thumbnailHtml}
                            <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 opacity-0 hover:opacity-100 transition-opacity duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <div class="flex flex-wrap mb-2">
                            <span class="video-badge badge-verified">Verified</span>
                            <span class="video-badge ${badgeClass}">${item.type.charAt(0).toUpperCase() + item.type.slice(1)}</span>
                        </div>
                        <h4>${item.title}</h4>
                        <p>${item.description}</p>
                        <div class="flex mt-2 space-x-2">
                            <a href="#" class="text-violet-400 hover:text-violet-300 hover:underline transition-colors duration-300 search-recommendation" data-query="${item.query}">Search for this</a>
                            <a href="#" class="text-red-400 hover:text-red-300 hover:underline transition-colors duration-300 play-recommendation" data-video-id="${videoId}">Play video</a>
                        </div>
                    </div>
                `;
                
                recommendationList.innerHTML += recommendationHtml;
            }
            
            // Add event listeners to search recommendation links
            document.querySelectorAll('.search-recommendation').forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const query = event.target.dataset.query;
                    searchInput.value = query;
                    fetchAndDisplayResults(query);
                });
            });
            
            // Add event listeners to play recommendation links
            document.querySelectorAll('.play-recommendation').forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const videoId = event.target.dataset.videoId;
                    openFullscreenModal(videoId);
                });
            });
            
            // Make the entire recommendation thumbnail area clickable
            document.querySelectorAll('.recommendation-item .video-thumbnail-container').forEach(container => {
                container.addEventListener('click', () => {
                    const videoId = container.closest('.recommendation-item').querySelector('.play-recommendation').dataset.videoId;
                    openFullscreenModal(videoId);
                });
            });
        }

        // Function to fetch and display search results
        async function fetchAndDisplayResults(query) {
            if (!query) {
                displayMessage('Please enter a search query.');
                return;
            }

            displayMessage('Searching...'); // Show loading message

            try {
                // Enhance query for educational content
                const enhancedQuery = `${query} tutorial how to`;
                
                // Use the YouTube Data API for searching
                const response = await fetch(`${SEARCH_URL}?part=snippet&q=${encodeURIComponent(enhancedQuery)}&key=${API_KEY}&maxResults=15&type=video&videoEmbeddable=true&videoSyndicated=true&safeSearch=strict`);

                if (!response.ok) {
                     // Handle HTTP errors
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Clear previous results
                resultsContainer.innerHTML = '';

                if (data.items.length === 0) {
                    displayNoResultsMessage(query);
                    return;
                }

                // Show loading message while filtering videos
                displayMessage('Checking videos for playability...');
                
                // Filter videos to ensure they have no restrictions
                const filteredVideos = [];
                for (const item of data.items) {
                    const videoId = item.id.videoId;
                    const isPlayable = await checkVideoPlayability(videoId);
                    
                    if (isPlayable) {
                        filteredVideos.push(item);
                        
                        // Limit to max 10 playable videos
                        if (filteredVideos.length >= 10) {
                            break;
                        }
                    }
                }
                
                // Clear loading message
                resultsContainer.innerHTML = '';
                
                if (filteredVideos.length === 0) {
                    displayNoResultsMessage(query);
                    return;
                }

                // Display filtered results
                for (const item of filteredVideos) {
                    const videoId = item.id.videoId;
                    const title = item.snippet.title;
                    const thumbnailUrl = item.snippet.thumbnails.high.url;
                    const channelTitle = item.snippet.channelTitle;
                    const publishedAt = new Date(item.snippet.publishedAt).toLocaleDateString();
                    
                    // Check if the thumbnail image is loadable
                    const thumbnailExists = await checkImage(thumbnailUrl);
                    
                    // Generate SVG thumbnail based on title and store it
                    let videoType = "default";
                    let color1 = "#5D5CDE"; // Default primary
                    let color2 = "#FF4E50"; // Default secondary
                    
                    // Determine video type and colors based on title
                    if (title.toLowerCase().includes("canva")) {
                        videoType = "canva";
                        color1 = "#00C4CC"; // Canva blue
                        color2 = "#7D2AE8"; // Canva purple
                    } else if (title.toLowerCase().includes("quizizz")) {
                        videoType = "quizizz";
                        color1 = "#FF7262"; // Quizizz coral
                        color2 = "#8854C0"; // Quizizz purple
                    }
                    
                    const svgThumbnail = generateSvgThumbnail(
                        title.length > 30 ? title.substring(0, 30) + "..." : title,
                        videoType,
                        color1,
                        color2
                    );
                    
                    // Store SVG thumbnail for use in modal
                    svgThumbnails[videoId] = svgThumbnail;
                    
                    // If thumbnail exists, store it, otherwise we'll use the SVG
                    if (thumbnailExists) {
                        videoThumbnails[videoId] = thumbnailUrl;
                    }
                    
                    // Create badges based on video data
                    let badgesHtml = `<span class="video-badge badge-verified">Verified</span>`;
                    
                    // Add topic badge
                    if (title.toLowerCase().includes('canva')) {
                        badgesHtml += `<span class="video-badge badge-canva">Canva</span>`;
                    } else if (title.toLowerCase().includes('quizizz')) {
                        badgesHtml += `<span class="video-badge badge-quizizz">Quizizz</span>`;
                    } else if (title.toLowerCase().includes('tutorial') || 
                        title.toLowerCase().includes('how to') ||
                        title.toLowerCase().includes('learn')) {
                        badgesHtml += `<span class="video-badge badge-educational">Educational</span>`;
                    }
                    
                    // Add HD badge if we have HD data
                    if (videoData[videoId] && 
                        videoData[videoId].contentDetails && 
                        videoData[videoId].contentDetails.definition === 'hd') {
                        badgesHtml += `<span class="video-badge badge-hd">HD</span>`;
                    }

                    const thumbnailHtml = thumbnailExists ? 
                        `<img src="${thumbnailUrl}" alt="${title} thumbnail" loading="lazy">` : 
                        svgThumbnail;

                    const videoElement = `
                        <div class="video-item" data-video-id="${videoId}">
                             <div class="video-thumbnail-container">
                                 ${thumbnailHtml}
                                 <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 hover:opacity-100 transition-opacity duration-300">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" viewBox="0 0 20 20" fill="currentColor">
                                         <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                     </svg>
                                 </div>
                            </div>
                            <div class="video-details">
                                <div class="flex flex-wrap mb-1">
                                    ${badgesHtml}
                                </div>
                                <h3>${title}</h3>
                                <p>Channel: ${channelTitle}</p>
                                <p class="text-sm text-gray-300">Published: ${publishedAt}</p>
                            </div>
                        </div>
                    `;
                    resultsContainer.innerHTML += videoElement;
                }

                // Add click listeners to the newly added video items
                addVideoItemClickListeners();

            } catch (error) {
                console.error('Error fetching data:', error);
                displayMessage(`An error occurred while fetching tutorials: ${error.message}. Please try again.`);
            }
        }

        // Function to display a no results message with suggestions
        function displayNoResultsMessage(query) {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <h3>No playable tutorials found</h3>
                    <p>We couldn't find unrestricted tutorials for "${query}". Try a different search term or check our recommendations below.</p>
                    <button id="try-suggested" class="mb-4">Try "Canva Tutorial" instead</button>
                </div>
            `;
            
            // Add event listener to the suggestion button
            document.getElementById('try-suggested').addEventListener('click', () => {
                searchInput.value = "Canva Tutorial";
                fetchAndDisplayResults("Canva Tutorial");
            });
        }

        // Function to add click listeners to video items
        function addVideoItemClickListeners() {
             // Get all video items after they have been added to the DOM
            const videoItems = resultsContainer.querySelectorAll('.video-item');

            videoItems.forEach(item => {
                item.addEventListener('click', () => {
                    const videoId = item.dataset.videoId; // Get video ID from data attribute
                    openFullscreenModal(videoId);
                });
            });
        }

        // Function to check if an image exists and is loadable
        function checkImage(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        // Function to open the fullscreen modal with improved loading and thumbnail
        async function openFullscreenModal(videoId) {
            // Show loading spinner
            videoLoader.style.display = 'flex';
            modalVideoIframe.classList.remove('loaded');
            
            // Verify the video is still playable (it might have changed since our last check)
            const isPlayable = await checkVideoPlayability(videoId);
            
            if (!isPlayable) {
                videoLoader.style.display = 'none';
                displayModalError("This video cannot be played due to restrictions. Please try another video.");
                return;
            }
            
            // Check if we have a stored thumbnail URL
            let thumbnailUrl = videoThumbnails[videoId];
            let useSvg = false;
            
            if (!thumbnailUrl) {
                // Try to get the highest quality thumbnail
                thumbnailUrl = `${THUMBNAIL_BASE_URL}${videoId}${THUMBNAIL_DEFAULT}`;
                
                // Check if the high quality thumbnail exists
                const imageExists = await checkImage(thumbnailUrl);
                
                // If not, fall back to the standard high quality
                if (!imageExists) {
                    thumbnailUrl = `${THUMBNAIL_BASE_URL}${videoId}${THUMBNAIL_FALLBACK}`;
                    const fallbackExists = await checkImage(thumbnailUrl);
                    
                    if (!fallbackExists) {
                        useSvg = true;
                    } else {
                        videoThumbnails[videoId] = thumbnailUrl;
                    }
                } else {
                    videoThumbnails[videoId] = thumbnailUrl;
                }
            }
            
            // Use appropriate thumbnail type
            if (useSvg) {
                // Use SVG thumbnail
                modalThumbnail.style.display = 'none';
                modalSvgContainer.style.display = 'block';
                modalSvgContainer.classList.remove('fade-out');
                
                // Get SVG content (generate if not exists)
                let svgContent = svgThumbnails[videoId];
                if (!svgContent) {
                    svgContent = generateSvgThumbnail("Video Tutorial", "default", "#5D5CDE", "#FF4E50");
                    svgThumbnails[videoId] = svgContent;
                }
                
                // Insert SVG content
                modalSvgContainer.innerHTML = svgContent;
            } else {
                // Use image thumbnail
                modalSvgContainer.style.display = 'none';
                modalThumbnail.style.display = 'block';
                modalThumbnail.src = thumbnailUrl;
                modalThumbnail.classList.remove('fade-out');
            }
            
            // Set up iframe with optimized parameters for seamless playback
            // origin parameter helps with security
            // rel=0 prevents showing related videos from other channels
            // modest branding reduces YouTube branding
            // fs=1 ensures fullscreen button is available
            const embedUrl = `${EMBED_BASE_URL}${videoId}?rel=0&enablejsapi=1&modestbranding=1&origin=${window.location.origin}&start=0&autoplay=1&iv_load_policy=3&fs=1&showinfo=0&controls=1`;
            modalVideoIframe.src = embedUrl;
            
            // Display the modal with fade-in effect
            fullscreenModal.style.display = 'flex';
            
            // Add slight delay before adding 'show' class for the transition to work
            setTimeout(() => {
                fullscreenModal.classList.add('show');
            }, 10);
            
            // Event listener for when the iframe is loaded
            modalVideoIframe.onload = function() {
                // Hide the loader
                videoLoader.style.display = 'none';
                // Show the iframe with fade-in effect
                modalVideoIframe.classList.add('loaded');
                // Fade out the thumbnail
                if (useSvg) {
                    modalSvgContainer.classList.add('fade-out');
                } else {
                    modalThumbnail.classList.add('fade-out');
                }
            };
            
            // Add error handling in case the video fails to load
            modalVideoIframe.onerror = function() {
                videoLoader.style.display = 'none';
                displayModalError("Video failed to load. Please try again.");
            };
            
            // Set a loading timeout to handle cases where onload doesn't trigger
            setTimeout(() => {
                if (!modalVideoIframe.classList.contains('loaded')) {
                    videoLoader.style.display = 'none';
                    modalVideoIframe.classList.add('loaded');
                    if (useSvg) {
                        modalSvgContainer.classList.add('fade-out');
                    } else {
                        modalThumbnail.classList.add('fade-out');
                    }
                }
            }, 5000); // 5-second fallback
        }

        // Function to display error in the modal
        function displayModalError(message) {
            videoLoader.style.display = 'none';
            const errorDiv = document.createElement('div');
            errorDiv.className = 'p-4 bg-red-600 text-white rounded absolute z-10';
            errorDiv.textContent = message;
            document.querySelector('.modal-content').appendChild(errorDiv);
            
            // Remove error message after 4 seconds
            setTimeout(() => {
                errorDiv.remove();
                closeFullscreenModal(); // Close the modal after showing the error
            }, 4000);
        }

        // Function to close the fullscreen modal with smooth transition
        function closeFullscreenModal() {
            // Start fade-out effect
            fullscreenModal.classList.remove('show');
            
            // Wait for fade-out to complete before hiding
            setTimeout(() => {
                fullscreenModal.style.display = 'none';
                // Stop the video by clearing the src after fade-out
                modalVideoIframe.src = '';
                modalVideoIframe.classList.remove('loaded');
                modalThumbnail.classList.remove('fade-out');
                modalSvgContainer.classList.remove('fade-out');
            }, 300); // Match the transition duration in CSS
        }

        // Function to display messages in the results container
        function displayMessage(message) {
            resultsContainer.innerHTML = `<p>${message}</p>`;
        }

        // Event listener for the search button
        searchButton.addEventListener('click', () => {
            const query = searchInput.value.trim();
            fetchAndDisplayResults(query);
        });

        // Event listener for pressing Enter in the search input
        searchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission if it were a form
                const query = searchInput.value.trim();
                fetchAndDisplayResults(query);
            }
        });

        // Event listener for the close button
        closeButton.addEventListener('click', closeFullscreenModal);

        // Close the modal if the user clicks outside of the modal content
        window.addEventListener('click', (event) => {
            if (event.target === fullscreenModal) {
                closeFullscreenModal();
            }
        });

        // Handle ESC key to close the modal
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && fullscreenModal.style.display === 'flex') {
                closeFullscreenModal();
            }
        });

        // Initialize recommended tutorials with thumbnails
        window.onload = () => {
            populateRecommendations();
        };
    </script>

</body>
</html>
